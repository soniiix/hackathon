{% extends 'base.html.twig' %}

{% block title %}Hackat'Agence - Liste des hackathons
{% endblock %}

{% block body %}

	<div class="container">
		<br>
		<div class="shadow p-3 mb-5 bg-white rounded">
			<h1>Liste des hackathons</h1>
		</div>

		{% for message in app.flashes('success') %}
			<div class="alert alert-success" role="alert">
				<h5>{{ message }}</h5>
			</div>
			<br>
    	{% endfor %}
		{% for message in app.flashes('failure') %}
			<div class="alert alert-danger" role="alert">
				<h5>{{ message }}</h5>
			</div>
			<br>
    	{% endfor %}

		<div
			class="container">
			<!-- barre de recherche -->
			<nav class="navbar">
				<div class="container-fluid">
					<a class="navbar-brand"></a>
					<form class="d-flex" role="search">
						{{ form_start(form) }}
						{{ form_row(form.titre) }}
						&nbsp;
						<button class="btn btn-primary" type="submit">OK</button>
						{{ form_end(form) }}
					</form>
				</div>
			</nav><br>

			<!-- affichage des hackathons -->
			<div class="row">
				{% set i = 0 %}
				{% for unHackathon in lesHackathons %}
					<div class="card" style="width: 20rem;">
						<div class="card-body">
							<h5 class="card-title">{{unHackathon.titre}}</h5>
							<p class="card-text">
								<strong>Date :
								</strong>
								{{unHackathon.dateDebut|date('d/m/Y')}}</p>
							<p class="card-text">
								<small class="text-body-secondary">{{unHackathon.nbPlacesMax}}
									places restantes</small>
							</p>

							<div class="accordion" id="accordionExample">
								<div class="accordion-item">
									<h2 class="accordion-header">
										<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_{{i}}">
											Détails
										</button>
									</h2>
									<div id="collapse_{{i}}" class="accordion-collapse collapse">
										<div class="accordion-body">
											<p>
												<strong>Adresse :
												</strong>
												{{unHackathon.rue}},
												{{unHackathon.codePostal}},
												{{unHackathon.ville}}
											</p>
											<p>
												<strong>Dates précises :
												</strong>
												<br>
												Du
												{{unHackathon.dateDebut|date('d/m/Y')}}
												à
												{{unHackathon.heureDebut|date('H:i')}}
												<br>
												Au
												{{unHackathon.dateFin|date('d/m/Y')}}
												à
												{{unHackathon.heureFin|date('H:i')}}
											</p>
											<p>
												<strong>Date limite d'inscription :
												</strong>
												{{unHackathon.dateLimiteInscription|date('d/m/Y')}}
											</p>
										</div>
									</div>
								</div>
							</div>
							{% set i = i + 1 %}
						</div>

						{% set dateLimiteInscription = unHackathon.dateLimiteInscription|date('Y-m-d') %}
						{% set dateActuelle = "now"|date("Y-m-d") %}
						<!-- si l'utilisateur est connecté et que la date limite d'inscription n'est pas dépassée,
						alors il peut s'inscrire à un hackathon -->
						{% if is_granted('IS_AUTHENTICATED_FULLY') and dateLimiteInscription > dateActuelle and unHackathon.nbPlacesMax >= 1 %}
							<form action="{{path('app_hackathon')}}" method="post">
								<div class="d-grid gap-2 col-6 mx-auto">
									<a class="btn btn-outline-primary" href="{{ path('app_inscription_hackathon',{idHackathon:unHackathon.id, idParticipant:app.user.id}) }}" role="button">S'inscrire</a>
									<br>
								</div>
							</form>
						{% endif %}
					</div>
				{% endfor %}
			</div><br>
		</div>
	</div>
{% endblock %}
